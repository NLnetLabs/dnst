[package]
name = "dnst"
version = "0.1.0"
edition = "2021"
authors = ["NLnet Labs <dns-team@nlnetlabs.nl>"]
description = "Reimplementation of important ldns programs."
repository = "https://github.com/NLnetLabs/dnst"
license = "BSD-3-Clause"
readme = "README.md"
default-run = "dnst"

[[bin]]
name = "ldns"
path = "src/bin/ldns.rs"

[dependencies]
arbitrary = { version = "1", optional = true, features = ["derive"] }
clap      = { version = "4", features = ["cargo", "derive"] }
#domain   = "0.10.3"
domain    = { git = "https://github.com/NLnetLabs/domain/", branch = "initial-nsec3-generation", features = ["ring", "unstable-validator"] }
lexopt    = "0.3.0"

[dev-dependencies]
test_bin = "0.4.0"

[features]
arbitrary = [ "dep:arbitrary", "domain/arbitrary" ]

[package.metadata.deb]
license-file = ["LICENSE", "0"]
depends = "$auto"
section = "net"
priority = "optional"
assets = [
    ["target/release/dnst", "usr/bin/", "755"],
    ["README.md", "usr/share/doc/dnst/", "644"],
    # TODO: Extend Ploutos to generate the man pages from sources.
    #["doc/dnst.1", "usr/share/man/man1/dnst.1", "644"],
]
changelog = "target/debian/changelog" # this will be generated by the pkg workflow
copyright = "Copyright (c) 2024, NLnet Labs. All rights reserved."
# preserve_symlinks didn't prevent error "Asset file path does not match any files"
# Perhaps a newer version of cargo-deb than the one used by Ploutos would fix this.
# Instead create and remove them using maintainer scripts.
#preserve-symlinks = true
maintainer-scripts = "pkg/debian"
replaces = "ldnsutils"

[package.metadata.generate-rpm]
# "BSD" alone is the 3-clause license. Inheriting "license" from above causes rpmlint to
# complain with "invalid-license".
# See: https://fedoraproject.org/wiki/Licensing:Main?rd=Licensing
license = "BSD"
assets = [
    { source = "target/release/dnst", dest = "/usr/bin/dnst", mode = "755" },
    # TODO: Extend Ploutos to generate the man pages from sources.
    #{ source = "doc/routinator.1", dest = "/usr/share/man/man1/routinator.1", mode = "644", doc = true },
]
obsoletes = [ "ldns-utils" ]
# These get set using cargo-generate-rpm --set-metadata at package build time.
#post_install_script = ...
#pre_uninstall_script = ...
#post_uninstall_script = ...